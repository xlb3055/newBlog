---
icon: pen-to-square
date: 2025-01-04
category:
- åç«¯
tag:
- é“¾è¡¨
- leecode
---

# 138. éšæœºé“¾è¡¨çš„å¤åˆ¶

## ğŸ“ é¢˜ç›®æè¿°
ç»™å®šä¸€ä¸ªåŒ…å«é¢å¤– `random` æŒ‡é’ˆçš„é“¾è¡¨ï¼Œ`random` å¯æŒ‡å‘é“¾è¡¨ä¸­ä»»æ„èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚è¦æ±‚æ„é€ è¯¥é“¾è¡¨çš„**æ·±æ‹·è´**ï¼šæ–°é“¾è¡¨ç”±å…¨æ–°èŠ‚ç‚¹ç»„æˆï¼Œå…¶ `next` å’Œ `random` æŒ‡é’ˆéœ€ä¸åŸé“¾è¡¨å¯¹åº”èŠ‚ç‚¹çš„æŒ‡é’ˆçŠ¶æ€ä¸€è‡´ï¼Œä¸”ä¸èƒ½æŒ‡å‘åŸé“¾è¡¨çš„èŠ‚ç‚¹ã€‚


## ğŸ“Œ ç¤ºä¾‹
### ç¤ºä¾‹ 1
è¾“å…¥ï¼š`head = [[7,null],[13,0],[11,4],[10,2],[1,0]]`
è¾“å‡ºï¼š`[[7,null],[13,0],[11,4],[10,2],[1,0]]`
è§£é‡Šï¼šæ–°é“¾è¡¨çš„èŠ‚ç‚¹å€¼ã€`next` æŒ‡å‘ã€`random` æŒ‡å‘å‡ä¸åŸé“¾è¡¨ä¸€è‡´ï¼Œä¸”æ‰€æœ‰èŠ‚ç‚¹ä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡ã€‚


## ğŸš€ æœ€ä¼˜è§£ï¼šåŸåœ°æ’å…¥æ³•ï¼ˆä¸‰æ­¥æ³•ï¼‰
### ğŸ” æ€è·¯è§£æ
æ ¸å¿ƒç­–ç•¥ï¼šé€šè¿‡**ä¸‰æ¬¡éå†**ï¼Œåœ¨åŸé“¾è¡¨åŸºç¡€ä¸Šæ„é€ æ–°èŠ‚ç‚¹ï¼Œé¿å…ä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨æ˜ å°„å…³ç³»ï¼š
1. **æ’å…¥æ–°èŠ‚ç‚¹**ï¼šéå†åŸé“¾è¡¨ï¼Œåœ¨æ¯ä¸ªåŸèŠ‚ç‚¹åæ’å…¥å¯¹åº”çš„æ–°èŠ‚ç‚¹ï¼ˆæ–°èŠ‚ç‚¹å€¼ä¸åŸèŠ‚ç‚¹ç›¸åŒï¼‰ï¼›
2. **è®¾ç½®æ–°èŠ‚ç‚¹çš„randomæŒ‡é’ˆ**ï¼šå†æ¬¡éå†ï¼Œè‹¥åŸèŠ‚ç‚¹çš„ `random` ä¸ä¸ºç©ºï¼Œæ–°èŠ‚ç‚¹çš„ `random` æŒ‡å‘åŸèŠ‚ç‚¹ `random` çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå³å¯¹åº”æ–°èŠ‚ç‚¹ï¼‰ï¼›
3. **æ‹†åˆ†é“¾è¡¨**ï¼šæœ€åéå†ï¼Œå°†æ–°èŠ‚ç‚¹ä»åŸé“¾è¡¨ä¸­æ‹†åˆ†å‡ºæ¥ï¼Œå½¢æˆç‹¬ç«‹çš„æ–°é“¾è¡¨ã€‚


---

## âœ… å®Œæ•´ä»£ç ï¼ˆJavaï¼‰
```java
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Scanner;

public class Main {
    private static void printRandomList(Node head) {
        if (head == null) {
            System.out.println(0);
            return;
        }
        List<Node> nodes = new ArrayList<>();
        Node cur = head;
        while (cur != null) {
            nodes.add(cur);
            cur = cur.next;
        }
        Map<Node, Integer> indexMap = new HashMap<>();
        for (int i = 0; i < nodes.size(); i++) {
            indexMap.put(nodes.get(i), i);
        }

        StringBuilder sb = new StringBuilder();
        sb.append(nodes.size()).append("\n");
        for (int i = 0; i < nodes.size(); i++) {
            Node node = nodes.get(i);
            sb.append(node.val).append(" ");
            if (node.random == null) {
                sb.append(-1);
            } else {
                sb.append(indexMap.get(node.random));
            }
            if (i < nodes.size() - 1) {
                sb.append("\n");
            }
        }
        System.out.print(sb.toString());
    }

    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        if (!scanner.hasNextInt()) {
            scanner.close();
            return;
        }
        int n = scanner.nextInt();
        Node[] nodes = new Node[n];
        int[] randomIndex = new int[n];

        for (int i = 0; i < n; i++) {
            int val = scanner.nextInt();
            int rand = scanner.nextInt();
            nodes[i] = new Node(val);
            randomIndex[i] = rand;
        }

        for (int i = 0; i < n - 1; i++) {
            nodes[i].next = nodes[i + 1];
        }
        for (int i = 0; i < n; i++) {
            int idx = randomIndex[i];
            if (idx >= 0 && idx < n) {
                nodes[i].random = nodes[idx];
            }
        }

        Node head = n == 0 ? null : nodes[0];
        Solution solution = new Solution();
        Node copied = solution.copyRandomList(head);
        printRandomList(copied);
        scanner.close();
    }
}

class Solution {
    public Node copyRandomList(Node head) {
        if (head == null) return null;

        // ç¬¬ä¸€æ­¥ï¼šåœ¨åŸèŠ‚ç‚¹åæ’å…¥æ–°èŠ‚ç‚¹ï¼ˆåŸ1â†’æ–°1â†’åŸ2â†’æ–°2...ï¼‰
        Node cur = head;
        while (cur != null) {
            Node newNode = new Node(cur.val);
            newNode.next = cur.next;
            cur.next = newNode;
            cur = newNode.next;
        }

        // ç¬¬äºŒæ­¥ï¼šè®¾ç½®æ–°èŠ‚ç‚¹çš„randomæŒ‡é’ˆ
        cur = head;
        while (cur != null) {
            if (cur.random != null) {
                // åŸèŠ‚ç‚¹randomçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯æ–°èŠ‚ç‚¹å¯¹åº”çš„random
                cur.next.random = cur.random.next;
            }
            cur = cur.next.next;
        }

        // ç¬¬ä¸‰æ­¥ï¼šæ‹†åˆ†åŸé“¾è¡¨ä¸æ–°é“¾è¡¨
        Node pre = new Node(0);
        Node preCur = pre;
        cur = head;
        while (cur != null) {
            Node temp = cur.next;
            cur.next = temp.next; // æ¢å¤åŸé“¾è¡¨
            preCur.next = temp;   // è¿æ¥æ–°èŠ‚ç‚¹
            cur = cur.next;
            preCur = temp;
        }
        return pre.next;
    }
}

class Node {
    int val;
    Node next;
    Node random;
    public Node(int val) {
        this.val = val;
        this.next = null;
        this.random = null;
    }
}
```


---

## ğŸ§  é€šä¿—æ˜“æ‡‚è§£é‡Š
å¯ä»¥æŠŠåŸé“¾è¡¨æƒ³è±¡æˆâ€œä¸€ä¸²æ—§ç å­â€ï¼Œæ·±æ‹·è´çš„è¿‡ç¨‹ç±»ä¼¼**ç»™æ¯ä¸ªæ—§ç å­ç»‘ä¸€ä¸ªæ–°ç å­ï¼Œå†æŠŠæ–°ç å­æ‹†å‡ºæ¥ä¸²æˆæ–°é“¾**ï¼š
1. **ç»‘æ–°ç å­**ï¼šåœ¨æ¯ä¸ªæ—§ç å­åç»‘ä¸€ä¸ªå’Œå®ƒä¸€æ ·çš„æ–°ç å­ï¼Œå½¢æˆâ€œæ—§1â†’æ–°1â†’æ—§2â†’æ–°2â€çš„é“¾ï¼›
2. **å¤åˆ¶randomæŒ‡å‘**ï¼šæ—§ç å­çš„randomæŒ‡å‘å“ªä¸ªæ—§ç å­ï¼Œå¯¹åº”çš„æ–°ç å­å°±æŒ‡å‘é‚£ä¸ªæ—§ç å­åçš„æ–°ç å­ï¼›
3. **æ‹†æ–°é“¾**ï¼šæŠŠæ‰€æœ‰æ–°ç å­ä»åŸé“¾ä¸­æ‹†å‡ºæ¥ï¼Œä¸²æˆç‹¬ç«‹çš„æ–°é“¾ï¼ŒåŒæ—¶æ¢å¤åŸé“¾çš„ç»“æ„ã€‚

ä»¥ç¤ºä¾‹1çš„èŠ‚ç‚¹ `13`ï¼ˆåŸèŠ‚ç‚¹ï¼‰ä¸ºä¾‹ï¼š
1. æ’å…¥æ–°èŠ‚ç‚¹ `13` åï¼Œé“¾å˜ä¸º `7â†’æ–°7â†’13â†’æ–°13â†’...`ï¼›
2. åŸèŠ‚ç‚¹ `13` çš„ `random` æŒ‡å‘åŸèŠ‚ç‚¹ `7`ï¼Œåˆ™æ–°èŠ‚ç‚¹ `13` çš„ `random` æŒ‡å‘åŸèŠ‚ç‚¹ `7` åçš„æ–°èŠ‚ç‚¹ `7`ï¼›
3. æ‹†åˆ†åï¼Œæ–°é“¾ä¸­ `æ–°13` çš„ `random` æ­£ç¡®æŒ‡å‘ `æ–°7`ã€‚


---

## â± æ—¶é—´å¤æ‚åº¦
- \(O(n)\)ï¼ˆ`n` ä¸ºé“¾è¡¨é•¿åº¦ï¼‰
  ä¸‰æ¬¡éå†é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»…è¢«å¤„ç†ä¸€æ¬¡ã€‚


---

## ğŸ’¾ ç©ºé—´å¤æ‚åº¦
- \(O(1)\)
  ä»…ä½¿ç”¨å¸¸æ•°çº§åˆ«çš„é¢å¤–ç©ºé—´ï¼ˆæ— å“ˆå¸Œè¡¨ç­‰å­˜å‚¨ç»“æ„ï¼‰ï¼Œç©ºé—´æ¶ˆè€—ä¸é“¾è¡¨é•¿åº¦æ— å…³ã€‚
