"use strict";(self.webpackChunkblog_road=self.webpackChunkblog_road||[]).push([[6588],{66262:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,l]of s)a[i]=l;return a}},72741:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>t,data:()=>h});var l=a(20641);const n=[(0,l.Fv)('<h1 id="mysql隐式转换索引失效" tabindex="-1"><a class="header-anchor" href="#mysql隐式转换索引失效"><span>MySQL隐式转换索引失效</span></a></h1><hr><h2 id="_1-前言" tabindex="-1"><a class="header-anchor" href="#_1-前言"><span><strong>1. 前言</strong></span></a></h2><h3 id="_1-1-什么是隐式转换" tabindex="-1"><a class="header-anchor" href="#_1-1-什么是隐式转换"><span><strong>1.1 什么是隐式转换？</strong></span></a></h3><p>MySQL 在执行 SQL 查询时，字段的数据类型如果与查询条件不一致，会进行类型转换。这种转换分为两种：</p><ol><li><strong>显式转换</strong>：由用户手动完成（如 <code>CAST</code> 或 <code>CONVERT</code>）。</li><li><strong>隐式转换</strong>：由 MySQL 自动完成。</li></ol><h3 id="_1-2-隐式转换的影响" tabindex="-1"><a class="header-anchor" href="#_1-2-隐式转换的影响"><span><strong>1.2 隐式转换的影响</strong></span></a></h3><p>隐式转换会导致索引失效，因为 MySQL 无法直接使用索引中的值进行匹配，而是需要对所有数据进行扫描，从而导致查询效率显著下降。</p><hr><h2 id="_2-数据准备" tabindex="-1"><a class="header-anchor" href="#_2-数据准备"><span><strong>2. 数据准备</strong></span></a></h2><p>以下是模拟隐式转换场景的数据表和样本数据：</p><h3 id="_2-1-创建测试表" tabindex="-1"><a class="header-anchor" href="#_2-1-创建测试表"><span><strong>2.1 创建测试表</strong></span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> users</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">PRIMARY KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    phone </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">15</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    age </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INT</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> idx_phone (phone) </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 为 phone 列创建索引</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-插入测试数据" tabindex="-1"><a class="header-anchor" href="#_2-2-插入测试数据"><span><strong>2.2 插入测试数据</strong></span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users (phone, age)</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VALUES</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;1234567890&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">25</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;0987654321&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;5556667777&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">28</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">),</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;3334445555&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">35</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_3-sql-测试" tabindex="-1"><a class="header-anchor" href="#_3-sql-测试"><span><strong>3. SQL 测试</strong></span></a></h2><h3 id="_3-1-使用索引的查询" tabindex="-1"><a class="header-anchor" href="#_3-1-使用索引的查询"><span><strong>3.1 使用索引的查询</strong></span></a></h3><p>以下查询可以直接使用索引，因为数据类型和查询条件一致：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EXPLAIN </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> phone </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;1234567890&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="执行计划结果" tabindex="-1"><a class="header-anchor" href="#执行计划结果"><span><strong>执行计划结果</strong>：</span></a></h4><table><thead><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>rows</th><th>Extra</th></tr></thead><tbody><tr><td>1</td><td>SIMPLE</td><td>users</td><td>ref</td><td>idx_phone</td><td>idx_phone</td><td>17</td><td>1</td><td>Using where</td></tr></tbody></table><ul><li><strong>解释</strong>： <ul><li><code>type = ref</code>：表示索引被使用。</li><li><code>key = idx_phone</code>：使用了 <code>phone</code> 的索引。</li></ul></li></ul><hr><h3 id="_3-2-隐式转换导致索引失效" tabindex="-1"><a class="header-anchor" href="#_3-2-隐式转换导致索引失效"><span><strong>3.2 隐式转换导致索引失效</strong></span></a></h3><p>如果查询条件中使用了不匹配的数据类型，会触发隐式转换：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EXPLAIN </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> phone </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1234567890</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="执行计划结果-1" tabindex="-1"><a class="header-anchor" href="#执行计划结果-1"><span><strong>执行计划结果</strong>：</span></a></h4><table><thead><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>rows</th><th>Extra</th></tr></thead><tbody><tr><td>1</td><td>SIMPLE</td><td>users</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>4</td><td>Using where</td></tr></tbody></table><ul><li><strong>解释</strong>： <ul><li><code>type = ALL</code>：表示全表扫描。</li><li>索引未被使用，因为查询中的 <code>1234567890</code> 是一个整数，而 <code>phone</code> 列是 <code>VARCHAR</code> 类型。</li></ul></li></ul><hr><h3 id="_3-3-常见的隐式转换场景" tabindex="-1"><a class="header-anchor" href="#_3-3-常见的隐式转换场景"><span><strong>3.3 常见的隐式转换场景</strong></span></a></h3><ol><li><p><strong>字符串与数值的比较</strong></p><ul><li>如果索引列是字符串类型，而查询条件是数值，则会触发隐式转换。</li><li>示例：<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> phone </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1234567890</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li><p><strong>字符集或排序规则不匹配</strong></p><ul><li>当表的字符集或排序规则与查询条件不一致时，也可能触发隐式转换。</li><li>示例：<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    col </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">CHARACTER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> utf8 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">COLLATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> utf8_general_ci,</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    INDEX</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> idx_col (col)</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> test </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> col </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;abc&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> COLLATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> utf8_bin;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><strong>函数操作</strong></p><ul><li>使用函数处理索引列会导致索引失效。</li><li>示例：<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> UPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(phone) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;1234567890&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li></ol><hr><h2 id="_4-分析和总结" tabindex="-1"><a class="header-anchor" href="#_4-分析和总结"><span><strong>4. 分析和总结</strong></span></a></h2><h3 id="_4-1-为什么隐式转换导致索引失效" tabindex="-1"><a class="header-anchor" href="#_4-1-为什么隐式转换导致索引失效"><span><strong>4.1 为什么隐式转换导致索引失效？</strong></span></a></h3><ol><li><p><strong>索引的工作原理</strong>：</p><ul><li>索引是基于原始字段值构建的，查询条件必须与索引列的类型完全一致，才能直接使用索引。</li></ul></li><li><p><strong>隐式转换的执行逻辑</strong>：</p><ul><li>当 MySQL 检测到数据类型不匹配时，会先对表中的所有数据进行类型转换，然后逐一比较，导致全表扫描。</li></ul></li></ol><hr><h3 id="_4-2-如何避免隐式转换" tabindex="-1"><a class="header-anchor" href="#_4-2-如何避免隐式转换"><span><strong>4.2 如何避免隐式转换？</strong></span></a></h3><h4 id="方法-1-确保数据类型一致" tabindex="-1"><a class="header-anchor" href="#方法-1-确保数据类型一致"><span><strong>方法 1：确保数据类型一致</strong></span></a></h4><ul><li>查询条件的类型要与字段类型一致。</li><li>示例：<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 正确：查询条件与字段类型匹配</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> phone </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;1234567890&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="方法-2-避免在索引列上使用函数" tabindex="-1"><a class="header-anchor" href="#方法-2-避免在索引列上使用函数"><span><strong>方法 2：避免在索引列上使用函数</strong></span></a></h4><ul><li>在索引列上应用函数操作会导致 MySQL 无法直接使用索引。</li><li>示例：<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 错误：使用函数导致索引失效</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> UPPER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(phone) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;1234567890&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 正确：直接使用原始字段值</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> phone </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;1234567890&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="方法-3-避免隐式类型转换" tabindex="-1"><a class="header-anchor" href="#方法-3-避免隐式类型转换"><span><strong>方法 3：避免隐式类型转换</strong></span></a></h4><ul><li>确保所有查询条件的类型显式匹配。</li><li>示例：<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 错误：触发隐式转换</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> phone </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1234567890</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- 正确：显式匹配类型</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> users </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> phone </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;1234567890&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="方法-4-统一字符集和排序规则" tabindex="-1"><a class="header-anchor" href="#方法-4-统一字符集和排序规则"><span><strong>方法 4：统一字符集和排序规则</strong></span></a></h4><ul><li>确保字段和查询条件使用相同的字符集和排序规则。</li><li>示例：<div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> test </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> col </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;abc&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> COLLATE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> utf8_general_ci;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><hr><h3 id="_4-3-优化建议" tabindex="-1"><a class="header-anchor" href="#_4-3-优化建议"><span><strong>4.3 优化建议</strong></span></a></h3><ol><li><p><strong>开发阶段的检查</strong>：</p><ul><li>在开发 SQL 时，使用 <code>EXPLAIN</code> 检查是否使用了索引。</li></ul></li><li><p><strong>索引设计优化</strong>：</p><ul><li>为查询频繁的字段建立合适的索引。</li><li>避免在低选择性字段上建立索引。</li></ul></li><li><p><strong>代码规范</strong>：</p><ul><li>明确查询条件的类型，不依赖 MySQL 自动转换。</li></ul></li><li><p><strong>监控查询性能</strong>：</p><ul><li>使用慢查询日志分析未优化的 SQL。</li><li>通过 <code>EXPLAIN</code> 了解执行计划。</li></ul></li></ol><hr><h3 id="_4-4-小结" tabindex="-1"><a class="header-anchor" href="#_4-4-小结"><span><strong>4.4 小结</strong></span></a></h3><ul><li><strong>隐式转换的核心问题</strong>： <ul><li>类型不匹配会触发全表扫描，导致查询效率下降。</li></ul></li><li><strong>解决思路</strong>： <ul><li>确保字段类型与查询条件一致。</li><li>避免在索引列上使用函数。</li><li>统一字符集和排序规则。</li></ul></li><li><strong>优化效果</strong>： <ul><li>通过上述方法，可避免隐式转换带来的索引失效，提高查询性能。</li></ul></li></ul>',53)],e={},t=(0,a(66262).A)(e,[["render",function(i,s){return(0,l.uX)(),(0,l.CE)("div",null,n)}]]),h=JSON.parse('{"path":"/Java%E5%85%AB%E8%82%A1/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E9%87%8D%E8%A6%81%E7%9F%A5%E8%AF%86%E7%82%B9/MySQL%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88.html","title":"MySQL隐式转换索引失效","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2024-11-23T00:00:00.000Z","category":["后端"],"tag":["MySQL","数据库"],"description":"MySQL隐式转换索引失效 1. 前言 1.1 什么是隐式转换？ MySQL 在执行 SQL 查询时，字段的数据类型如果与查询条件不一致，会进行类型转换。这种转换分为两种： 显式转换：由用户手动完成（如 CAST 或 CONVERT）。 隐式转换：由 MySQL 自动完成。 1.2 隐式转换的影响 隐式转换会导致索引失效，因为 MySQL 无法直接使用...","head":[["meta",{"property":"og:url","content":"https://xlb3055.github.io/newBlog/Java%E5%85%AB%E8%82%A1/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/%E9%87%8D%E8%A6%81%E7%9F%A5%E8%AF%86%E7%82%B9/MySQL%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88.html"}],["meta",{"property":"og:site_name","content":"Bin的技术博客"}],["meta",{"property":"og:title","content":"MySQL隐式转换索引失效"}],["meta",{"property":"og:description","content":"MySQL隐式转换索引失效 1. 前言 1.1 什么是隐式转换？ MySQL 在执行 SQL 查询时，字段的数据类型如果与查询条件不一致，会进行类型转换。这种转换分为两种： 显式转换：由用户手动完成（如 CAST 或 CONVERT）。 隐式转换：由 MySQL 自动完成。 1.2 隐式转换的影响 隐式转换会导致索引失效，因为 MySQL 无法直接使用..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-06-06T06:24:41.000Z"}],["meta",{"property":"article:author","content":"Bin"}],["meta",{"property":"article:tag","content":"MySQL"}],["meta",{"property":"article:tag","content":"数据库"}],["meta",{"property":"article:published_time","content":"2024-11-23T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-06-06T06:24:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL隐式转换索引失效\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-11-23T00:00:00.000Z\\",\\"dateModified\\":\\"2025-06-06T06:24:41.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Bin\\",\\"url\\":\\"/avator_img.jpg\\"}]}"]]},"headers":[{"level":2,"title":"1. 前言","slug":"_1-前言","link":"#_1-前言","children":[{"level":3,"title":"1.1 什么是隐式转换？","slug":"_1-1-什么是隐式转换","link":"#_1-1-什么是隐式转换","children":[]},{"level":3,"title":"1.2 隐式转换的影响","slug":"_1-2-隐式转换的影响","link":"#_1-2-隐式转换的影响","children":[]}]},{"level":2,"title":"2. 数据准备","slug":"_2-数据准备","link":"#_2-数据准备","children":[{"level":3,"title":"2.1 创建测试表","slug":"_2-1-创建测试表","link":"#_2-1-创建测试表","children":[]},{"level":3,"title":"2.2 插入测试数据","slug":"_2-2-插入测试数据","link":"#_2-2-插入测试数据","children":[]}]},{"level":2,"title":"3. SQL 测试","slug":"_3-sql-测试","link":"#_3-sql-测试","children":[{"level":3,"title":"3.1 使用索引的查询","slug":"_3-1-使用索引的查询","link":"#_3-1-使用索引的查询","children":[]},{"level":3,"title":"3.2 隐式转换导致索引失效","slug":"_3-2-隐式转换导致索引失效","link":"#_3-2-隐式转换导致索引失效","children":[]},{"level":3,"title":"3.3 常见的隐式转换场景","slug":"_3-3-常见的隐式转换场景","link":"#_3-3-常见的隐式转换场景","children":[]}]},{"level":2,"title":"4. 分析和总结","slug":"_4-分析和总结","link":"#_4-分析和总结","children":[{"level":3,"title":"4.1 为什么隐式转换导致索引失效？","slug":"_4-1-为什么隐式转换导致索引失效","link":"#_4-1-为什么隐式转换导致索引失效","children":[]},{"level":3,"title":"4.2 如何避免隐式转换？","slug":"_4-2-如何避免隐式转换","link":"#_4-2-如何避免隐式转换","children":[]},{"level":3,"title":"4.3 优化建议","slug":"_4-3-优化建议","link":"#_4-3-优化建议","children":[]},{"level":3,"title":"4.4 小结","slug":"_4-4-小结","link":"#_4-4-小结","children":[]}]}],"git":{"createdTime":1733029796000,"updatedTime":1749191081000,"contributors":[{"name":"bin","email":"13598151+binxlb@user.noreply.gitee.com","commits":1}]},"readingTime":{"minutes":3.88,"words":1164},"filePathRelative":"Java八股/数据库/MySQL/重要知识点/MySQL隐式转换索引失效.md","localizedDate":"2024年11月23日","excerpt":"\\n<hr>\\n<h2><strong>1. 前言</strong></h2>\\n<h3><strong>1.1 什么是隐式转换？</strong></h3>\\n<p>MySQL 在执行 SQL 查询时，字段的数据类型如果与查询条件不一致，会进行类型转换。这种转换分为两种：</p>\\n<ol>\\n<li><strong>显式转换</strong>：由用户手动完成（如 <code>CAST</code> 或 <code>CONVERT</code>）。</li>\\n<li><strong>隐式转换</strong>：由 MySQL 自动完成。</li>\\n</ol>\\n<h3><strong>1.2 隐式转换的影响</strong></h3>","autoDesc":true}')}}]);