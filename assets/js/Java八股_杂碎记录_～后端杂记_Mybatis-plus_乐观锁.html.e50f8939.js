"use strict";(self.webpackChunkblog_road=self.webpackChunkblog_road||[]).push([[245],{6262:(i,s)=>{s.A=(i,s)=>{const n=i.__vccOpts||i;for(const[i,a]of s)n[i]=a;return n}},7430:(i,s,n)=>{n.r(s),n.d(s,{comp:()=>l,data:()=>r});var a=n(641);const e=[(0,a.Fv)('<h1 id="mybatis-plus乐观锁" tabindex="-1"><a class="header-anchor" href="#mybatis-plus乐观锁"><span>Mybatis-plus乐观锁</span></a></h1><h2 id="什么是乐观锁" tabindex="-1"><a class="header-anchor" href="#什么是乐观锁"><span>什么是乐观锁</span></a></h2><p>乐观锁：顾名思义十分乐观，他总是认为不会出现问题，无论干什么都<strong>不去上锁</strong>，如果出现了问题，再次更新值测试<br> 与之相对的是<strong>悲观锁</strong><br> 悲观锁：顾名思义十分悲观，他认为总是会出现问题，无论干什么都会<strong>上锁再去操作</strong></p><h2 id="乐观锁的机制" tabindex="-1"><a class="header-anchor" href="#乐观锁的机制"><span>乐观锁的机制：</span></a></h2><p>乐观锁的实现方式：</p><ul><li>取出记录时，获取当前version</li><li>更新时，带上这个version</li><li>执行更新时，set version = newVersion where version = oldVersion</li><li>如果version不对，就更新失败</li></ul><div class="language-mysql line-numbers-mode" data-highlighter="shiki" data-ext="mysql" data-title="mysql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>乐观锁：1. 先查询，获得版本号 version = 1</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span># --A</span></span>\n<span class="line"><span>update user set name = &quot;huo&quot;, version = version +1</span></span>\n<span class="line"><span>where id = 2 and version = 1</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span># --B 线程抢先完成，这个时候 version = 2，会导致A 修改失败</span></span>\n<span class="line"><span>update user set name = &quot;huo&quot;, version = version +1</span></span>\n<span class="line"><span>where id = 2 and version = 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="乐观锁的使用" tabindex="-1"><a class="header-anchor" href="#乐观锁的使用"><span>乐观锁的使用</span></a></h2><p>测试以下MP的乐观锁插件：</p><ol><li>给数据库中增加version字段</li><li>实体类添加相应version字段，加上@Version注解</li><li>注册组件<div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">MapperScan</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;com.dreamingnotes.mapper&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// 扫描mapper文件夹</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">EnableTransactionManagement</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // 开启事务管理</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // 配置类</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> MyBatisPlusConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 注册乐观锁插件</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> OptimisticLockerInnerInterceptor</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> optimisticLockerInnerInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> OptimisticLockerInnerInterceptor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol>',10)],t={},l=(0,n(6262).A)(t,[["render",function(i,s){return(0,a.uX)(),(0,a.CE)("div",null,e)}]]),r=JSON.parse('{"path":"/Java%E5%85%AB%E8%82%A1/%E6%9D%82%E7%A2%8E%E8%AE%B0%E5%BD%95/%EF%BD%9E%E5%90%8E%E7%AB%AF%E6%9D%82%E8%AE%B0/Mybatis-plus/%E4%B9%90%E8%A7%82%E9%94%81.html","title":"Mybatis-plus乐观锁","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2024-08-11T00:00:00.000Z","category":["后端"],"tag":["Mybatis-plus","后端开发技巧"],"description":"Mybatis-plus乐观锁 什么是乐观锁 乐观锁：顾名思义十分乐观，他总是认为不会出现问题，无论干什么都不去上锁，如果出现了问题，再次更新值测试 与之相对的是悲观锁 悲观锁：顾名思义十分悲观，他认为总是会出现问题，无论干什么都会上锁再去操作 乐观锁的机制： 乐观锁的实现方式： 取出记录时，获取当前version 更新时，带上这个version 执行...","head":[["meta",{"property":"og:url","content":"https://xlb3055.github.io/newBlog/Java%E5%85%AB%E8%82%A1/%E6%9D%82%E7%A2%8E%E8%AE%B0%E5%BD%95/%EF%BD%9E%E5%90%8E%E7%AB%AF%E6%9D%82%E8%AE%B0/Mybatis-plus/%E4%B9%90%E8%A7%82%E9%94%81.html"}],["meta",{"property":"og:site_name","content":"Bin的成长博客"}],["meta",{"property":"og:title","content":"Mybatis-plus乐观锁"}],["meta",{"property":"og:description","content":"Mybatis-plus乐观锁 什么是乐观锁 乐观锁：顾名思义十分乐观，他总是认为不会出现问题，无论干什么都不去上锁，如果出现了问题，再次更新值测试 与之相对的是悲观锁 悲观锁：顾名思义十分悲观，他认为总是会出现问题，无论干什么都会上锁再去操作 乐观锁的机制： 乐观锁的实现方式： 取出记录时，获取当前version 更新时，带上这个version 执行..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-06-06T06:24:41.000Z"}],["meta",{"property":"article:author","content":"Bin"}],["meta",{"property":"article:tag","content":"Mybatis-plus"}],["meta",{"property":"article:tag","content":"后端开发技巧"}],["meta",{"property":"article:published_time","content":"2024-08-11T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-06-06T06:24:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Mybatis-plus乐观锁\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-08-11T00:00:00.000Z\\",\\"dateModified\\":\\"2025-06-06T06:24:41.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Bin\\",\\"url\\":\\"/avator_img.jpg\\"}]}"]]},"headers":[{"level":2,"title":"什么是乐观锁","slug":"什么是乐观锁","link":"#什么是乐观锁","children":[]},{"level":2,"title":"乐观锁的机制：","slug":"乐观锁的机制","link":"#乐观锁的机制","children":[]},{"level":2,"title":"乐观锁的使用","slug":"乐观锁的使用","link":"#乐观锁的使用","children":[]}],"git":{"createdTime":1732275083000,"updatedTime":1749191081000,"contributors":[{"name":"bin","email":"13598151+binxlb@user.noreply.gitee.com","commits":1}]},"readingTime":{"minutes":1.1,"words":330},"filePathRelative":"Java八股/杂碎记录/～后端杂记/Mybatis-plus/乐观锁.md","localizedDate":"2024年8月11日","excerpt":"\\n<h2>什么是乐观锁</h2>\\n<p>乐观锁：顾名思义十分乐观，他总是认为不会出现问题，无论干什么都<strong>不去上锁</strong>，如果出现了问题，再次更新值测试<br>\\n与之相对的是<strong>悲观锁</strong><br>\\n悲观锁：顾名思义十分悲观，他认为总是会出现问题，无论干什么都会<strong>上锁再去操作</strong></p>\\n<h2>乐观锁的机制：</h2>\\n<p>乐观锁的实现方式：</p>\\n<ul>\\n<li>取出记录时，获取当前version</li>\\n<li>更新时，带上这个version</li>\\n<li>执行更新时，set version = newVersion where version = oldVersion</li>\\n<li>如果version不对，就更新失败</li>\\n</ul>","autoDesc":true}')}}]);