"use strict";(self.webpackChunkblog_road=self.webpackChunkblog_road||[]).push([[2126],{66262:(i,e)=>{e.A=(i,e)=>{const t=i.__vccOpts||i;for(const[i,a]of e)t[i]=a;return t}},69525:(i,e,t)=>{t.r(e),t.d(e,{comp:()=>n,data:()=>r});var a=t(20641);const l=[(0,a.Fv)('<h1 id="因素03-掌控上下文窗口" tabindex="-1"><a class="header-anchor" href="#因素03-掌控上下文窗口"><span>因素03：掌控上下文窗口</span></a></h1><blockquote><p>来源：12-Factor Agents / Factor 3（Own your context window）</p></blockquote><h2 id="一句话先懂" tabindex="-1"><a class="header-anchor" href="#一句话先懂"><span>一句话先懂</span></a></h2><p>模型是“无状态函数”，它只会基于你给的上下文做判断。上下文质量，直接决定输出质量。</p><h2 id="奶奶版理解" tabindex="-1"><a class="header-anchor" href="#奶奶版理解"><span>奶奶版理解</span></a></h2><p>看病时如果只说“我不舒服”，医生只能猜。<br> 如果你给出病历、检查单、过敏史，诊断就会更准。</p><p>上下文窗口就是给模型的“病历袋”。</p><h2 id="原文最关键的-3-个观点" tabindex="-1"><a class="header-anchor" href="#原文最关键的-3-个观点"><span>原文最关键的 3 个观点</span></a></h2><ol><li>上下文不止是聊天记录，还包括：提示词、RAG 文档、工具结果、历史事件。</li><li>不必死守标准 chat message 格式，可设计更高密度的自定义格式。</li><li>目标是“对模型更友好”：高信息密度、低噪声、可控安全。</li></ol><h2 id="标准格式-vs-自定义格式" tabindex="-1"><a class="header-anchor" href="#标准格式-vs-自定义格式"><span>标准格式 vs 自定义格式</span></a></h2><p>标准 chat 很通用，但在复杂 agent 中往往冗长。</p><p>可改成事件流：</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">slack_message</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;部署后端到生产&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">slack_message</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">list_git_tags_result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;[v1.2.3, v1.2.2]&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">list_git_tags_result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">approval_required</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;true&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">approval_required</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">question</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;请选择版本&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">question</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这种格式更适合“下一步决策”任务。</p><h2 id="落地建议-能直接用" tabindex="-1"><a class="header-anchor" href="#落地建议-能直接用"><span>落地建议（能直接用）</span></a></h2><ol><li>建立统一 <code>Event</code> 类型，沉淀成 thread。</li><li>构建 <code>thread -&gt; prompt</code> 转换器，可替换策略。</li><li>做上下文压缩：保留关键事实，合并冗余历史。</li><li>敏感信息默认脱敏，只给最小必要字段。</li></ol><h2 id="真实场景-部署失败恢复" tabindex="-1"><a class="header-anchor" href="#真实场景-部署失败恢复"><span>真实场景：部署失败恢复</span></a></h2><p>部署报错后，不要把 500 行日志全塞给模型，建议只给：</p><ul><li>错误类型：连接超时</li><li>目标服务：deploy-api</li><li>重试次数：2/3</li><li>建议动作：检查服务状态或请求人工</li></ul><p>模型更容易做出正确下一步。</p><h2 id="常见误区" tabindex="-1"><a class="header-anchor" href="#常见误区"><span>常见误区</span></a></h2><ul><li>认为上下文越多越好。</li><li>错误历史不压缩，导致注意力稀释。</li><li>把密钥、隐私信息直接塞入上下文。</li></ul><h2 id="我的思考" tabindex="-1"><a class="header-anchor" href="#我的思考"><span>我的思考</span></a></h2><p>这条是 12 因素里最“值钱”的一条之一。</p><p>很多人把注意力放在模型参数调优，但在生产里，提升最大的通常是：</p><ul><li>上下文组织</li><li>信息密度</li><li>噪声控制</li></ul><p>也就是说：先做上下文工程，再谈模型玄学。</p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h2><ul><li>上下文就是模型的世界。</li><li>结构化上下文通常优于原始聊天堆叠。</li><li>谁掌控上下文，谁掌控智能体效果上限。</li></ul>',29)],s={},n=(0,t(66262).A)(s,[["render",function(i,e){return(0,a.uX)(),(0,a.CE)("div",null,l)}]]),r=JSON.parse('{"path":"/%E5%A5%B6%E5%A5%B6%E5%85%AB%E8%82%A1/12%E5%9B%A0%E7%B4%A0%E6%99%BA%E8%83%BD%E4%BD%93/03-%E6%8E%8C%E6%8E%A7%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AA%97%E5%8F%A3.html","title":"因素03：掌控上下文窗口","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2026-02-13T00:00:00.000Z","category":["后端"],"tag":["12因素智能体","大模型","Factor-03"],"description":"因素03：掌控上下文窗口 来源：12-Factor Agents / Factor 3（Own your context window） 一句话先懂 模型是“无状态函数”，它只会基于你给的上下文做判断。上下文质量，直接决定输出质量。 奶奶版理解 看病时如果只说“我不舒服”，医生只能猜。 如果你给出病历、检查单、过敏史，诊断就会更准。 上下文窗口就是给模...","head":[["meta",{"property":"og:url","content":"https://xlb3055.github.io/newBlog/%E5%A5%B6%E5%A5%B6%E5%85%AB%E8%82%A1/12%E5%9B%A0%E7%B4%A0%E6%99%BA%E8%83%BD%E4%BD%93/03-%E6%8E%8C%E6%8E%A7%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AA%97%E5%8F%A3.html"}],["meta",{"property":"og:site_name","content":"Bin的技术博客"}],["meta",{"property":"og:title","content":"因素03：掌控上下文窗口"}],["meta",{"property":"og:description","content":"因素03：掌控上下文窗口 来源：12-Factor Agents / Factor 3（Own your context window） 一句话先懂 模型是“无状态函数”，它只会基于你给的上下文做判断。上下文质量，直接决定输出质量。 奶奶版理解 看病时如果只说“我不舒服”，医生只能猜。 如果你给出病历、检查单、过敏史，诊断就会更准。 上下文窗口就是给模..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-13T07:34:00.000Z"}],["meta",{"property":"article:author","content":"Bin"}],["meta",{"property":"article:tag","content":"12因素智能体"}],["meta",{"property":"article:tag","content":"大模型"}],["meta",{"property":"article:tag","content":"Factor-03"}],["meta",{"property":"article:published_time","content":"2026-02-13T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-13T07:34:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"因素03：掌控上下文窗口\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2026-02-13T00:00:00.000Z\\",\\"dateModified\\":\\"2026-02-13T07:34:00.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Bin\\",\\"url\\":\\"/avator_img.jpg\\"}]}"]]},"headers":[{"level":2,"title":"一句话先懂","slug":"一句话先懂","link":"#一句话先懂","children":[]},{"level":2,"title":"奶奶版理解","slug":"奶奶版理解","link":"#奶奶版理解","children":[]},{"level":2,"title":"原文最关键的 3 个观点","slug":"原文最关键的-3-个观点","link":"#原文最关键的-3-个观点","children":[]},{"level":2,"title":"标准格式 vs 自定义格式","slug":"标准格式-vs-自定义格式","link":"#标准格式-vs-自定义格式","children":[]},{"level":2,"title":"落地建议（能直接用）","slug":"落地建议-能直接用","link":"#落地建议-能直接用","children":[]},{"level":2,"title":"真实场景：部署失败恢复","slug":"真实场景-部署失败恢复","link":"#真实场景-部署失败恢复","children":[]},{"level":2,"title":"常见误区","slug":"常见误区","link":"#常见误区","children":[]},{"level":2,"title":"我的思考","slug":"我的思考","link":"#我的思考","children":[]},{"level":2,"title":"小结","slug":"小结","link":"#小结","children":[]}],"git":{"createdTime":1770968040000,"updatedTime":1770968040000,"contributors":[{"name":"bin","email":"13598151+binxlb@user.noreply.gitee.com","commits":1}]},"readingTime":{"minutes":2,"words":601},"filePathRelative":"奶奶八股/12因素智能体/03-掌控上下文窗口.md","localizedDate":"2026年2月13日","excerpt":"\\n<blockquote>\\n<p>来源：12-Factor Agents / Factor 3（Own your context window）</p>\\n</blockquote>\\n<h2>一句话先懂</h2>\\n<p>模型是“无状态函数”，它只会基于你给的上下文做判断。上下文质量，直接决定输出质量。</p>\\n<h2>奶奶版理解</h2>\\n<p>看病时如果只说“我不舒服”，医生只能猜。<br>\\n如果你给出病历、检查单、过敏史，诊断就会更准。</p>\\n<p>上下文窗口就是给模型的“病历袋”。</p>\\n<h2>原文最关键的 3 个观点</h2>\\n<ol>\\n<li>上下文不止是聊天记录，还包括：提示词、RAG 文档、工具结果、历史事件。</li>\\n<li>不必死守标准 chat message 格式，可设计更高密度的自定义格式。</li>\\n<li>目标是“对模型更友好”：高信息密度、低噪声、可控安全。</li>\\n</ol>","autoDesc":true}')}}]);