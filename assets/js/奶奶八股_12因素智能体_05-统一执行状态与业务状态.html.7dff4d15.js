"use strict";(self.webpackChunkblog_road=self.webpackChunkblog_road||[]).push([[1912],{66262:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,t]of s)a[i]=t;return a}},23148:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>n,data:()=>h});var t=a(20641);const e=[(0,t.Fv)('<h1 id="因素05-统一执行状态与业务状态" tabindex="-1"><a class="header-anchor" href="#因素05-统一执行状态与业务状态"><span>因素05：统一执行状态与业务状态</span></a></h1><blockquote><p>来源：12-Factor Agents / Factor 5（Unify execution state and business state）</p></blockquote><h2 id="一句话先懂" tabindex="-1"><a class="header-anchor" href="#一句话先懂"><span>一句话先懂</span></a></h2><p>尽量用一条事件线程同时承载“业务发生了什么”和“流程走到哪”，减少双状态系统的复杂度。</p><h2 id="奶奶版理解" tabindex="-1"><a class="header-anchor" href="#奶奶版理解"><span>奶奶版理解</span></a></h2><p>做饭时你记一本流水账：</p><ul><li>买菜</li><li>切菜</li><li>炒到一半停电</li></ul><p>这本账既告诉你“饭做到哪步”，也告诉你“发生了什么事”。<br> 不需要再单独维护一本“流程状态账”。</p><h2 id="原文核心思想" tabindex="-1"><a class="header-anchor" href="#原文核心思想"><span>原文核心思想</span></a></h2><p>传统系统常分两套状态：</p><ul><li>执行状态：当前步骤、重试次数、是否等待</li><li>业务状态：对话历史、工具调用结果</li></ul><p>两套一旦不同步，问题排查会非常痛苦。</p><h2 id="推荐方案-事件线程-thread" tabindex="-1"><a class="header-anchor" href="#推荐方案-事件线程-thread"><span>推荐方案：事件线程（thread）</span></a></h2><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;thread_id&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;t_1001&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;events&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;type&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;user_request&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;data&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;发布后端&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">},</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;type&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;list_tags_result&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;data&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;v1.2.3&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]},</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;type&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;approval_requested&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;data&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">&quot;target&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;oncall&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}}</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  ]</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过最后几个事件，通常可直接推导当前执行状态。</p><h2 id="为什么这会更稳" tabindex="-1"><a class="header-anchor" href="#为什么这会更稳"><span>为什么这会更稳</span></a></h2><ul><li>单一事实源（single source of truth）</li><li>更易序列化和持久化</li><li>回放调试和断点恢复天然支持</li><li>方便做可视化审计</li></ul><h2 id="边界提醒" tabindex="-1"><a class="header-anchor" href="#边界提醒"><span>边界提醒</span></a></h2><p>不是所有东西都应写进线程：</p><ul><li>敏感凭证</li><li>临时会话密钥</li><li>合规限制数据</li></ul><p>这类数据应存在安全域，用引用 ID 关联。</p><h2 id="常见误区" tabindex="-1"><a class="header-anchor" href="#常见误区"><span>常见误区</span></a></h2><ul><li>事件类型随意命名，后续难维护。</li><li>没有幂等 event_id，重复写入导致状态污染。</li><li>线程存了“最终结论”，却没存“过程事件”。</li></ul><h2 id="我的思考" tabindex="-1"><a class="header-anchor" href="#我的思考"><span>我的思考</span></a></h2><p>我把这条理解为 AI 场景下的“轻量事件溯源”。<br> 只要你能重放 thread，你就几乎拥有：</p><ul><li>可恢复</li><li>可解释</li><li>可审计</li><li>可分支试验</li></ul><p>这比在多个表里拼状态可靠得多。</p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h2><ul><li>优先追求一份统一线程。</li><li>过程事件比最终状态更有价值。</li><li>状态可重放，系统才真正可维护。</li></ul>',29)],l={},n=(0,a(66262).A)(l,[["render",function(i,s){return(0,t.uX)(),(0,t.CE)("div",null,e)}]]),h=JSON.parse('{"path":"/%E5%A5%B6%E5%A5%B6%E5%85%AB%E8%82%A1/12%E5%9B%A0%E7%B4%A0%E6%99%BA%E8%83%BD%E4%BD%93/05-%E7%BB%9F%E4%B8%80%E6%89%A7%E8%A1%8C%E7%8A%B6%E6%80%81%E4%B8%8E%E4%B8%9A%E5%8A%A1%E7%8A%B6%E6%80%81.html","title":"因素05：统一执行状态与业务状态","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2026-02-13T00:00:00.000Z","category":["后端"],"tag":["12因素智能体","大模型","Factor-05"],"description":"因素05：统一执行状态与业务状态 来源：12-Factor Agents / Factor 5（Unify execution state and business state） 一句话先懂 尽量用一条事件线程同时承载“业务发生了什么”和“流程走到哪”，减少双状态系统的复杂度。 奶奶版理解 做饭时你记一本流水账： 买菜 切菜 炒到一半停电 这本账既告诉...","head":[["meta",{"property":"og:url","content":"https://xlb3055.github.io/newBlog/%E5%A5%B6%E5%A5%B6%E5%85%AB%E8%82%A1/12%E5%9B%A0%E7%B4%A0%E6%99%BA%E8%83%BD%E4%BD%93/05-%E7%BB%9F%E4%B8%80%E6%89%A7%E8%A1%8C%E7%8A%B6%E6%80%81%E4%B8%8E%E4%B8%9A%E5%8A%A1%E7%8A%B6%E6%80%81.html"}],["meta",{"property":"og:site_name","content":"Bin的技术博客"}],["meta",{"property":"og:title","content":"因素05：统一执行状态与业务状态"}],["meta",{"property":"og:description","content":"因素05：统一执行状态与业务状态 来源：12-Factor Agents / Factor 5（Unify execution state and business state） 一句话先懂 尽量用一条事件线程同时承载“业务发生了什么”和“流程走到哪”，减少双状态系统的复杂度。 奶奶版理解 做饭时你记一本流水账： 买菜 切菜 炒到一半停电 这本账既告诉..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-13T07:34:00.000Z"}],["meta",{"property":"article:author","content":"Bin"}],["meta",{"property":"article:tag","content":"12因素智能体"}],["meta",{"property":"article:tag","content":"大模型"}],["meta",{"property":"article:tag","content":"Factor-05"}],["meta",{"property":"article:published_time","content":"2026-02-13T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-13T07:34:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"因素05：统一执行状态与业务状态\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2026-02-13T00:00:00.000Z\\",\\"dateModified\\":\\"2026-02-13T07:34:00.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Bin\\",\\"url\\":\\"/avator_img.jpg\\"}]}"]]},"headers":[{"level":2,"title":"一句话先懂","slug":"一句话先懂","link":"#一句话先懂","children":[]},{"level":2,"title":"奶奶版理解","slug":"奶奶版理解","link":"#奶奶版理解","children":[]},{"level":2,"title":"原文核心思想","slug":"原文核心思想","link":"#原文核心思想","children":[]},{"level":2,"title":"推荐方案：事件线程（thread）","slug":"推荐方案-事件线程-thread","link":"#推荐方案-事件线程-thread","children":[]},{"level":2,"title":"为什么这会更稳","slug":"为什么这会更稳","link":"#为什么这会更稳","children":[]},{"level":2,"title":"边界提醒","slug":"边界提醒","link":"#边界提醒","children":[]},{"level":2,"title":"常见误区","slug":"常见误区","link":"#常见误区","children":[]},{"level":2,"title":"我的思考","slug":"我的思考","link":"#我的思考","children":[]},{"level":2,"title":"小结","slug":"小结","link":"#小结","children":[]}],"git":{"createdTime":1770968040000,"updatedTime":1770968040000,"contributors":[{"name":"bin","email":"13598151+binxlb@user.noreply.gitee.com","commits":1}]},"readingTime":{"minutes":1.7,"words":509},"filePathRelative":"奶奶八股/12因素智能体/05-统一执行状态与业务状态.md","localizedDate":"2026年2月13日","excerpt":"\\n<blockquote>\\n<p>来源：12-Factor Agents / Factor 5（Unify execution state and business state）</p>\\n</blockquote>\\n<h2>一句话先懂</h2>\\n<p>尽量用一条事件线程同时承载“业务发生了什么”和“流程走到哪”，减少双状态系统的复杂度。</p>\\n<h2>奶奶版理解</h2>\\n<p>做饭时你记一本流水账：</p>\\n<ul>\\n<li>买菜</li>\\n<li>切菜</li>\\n<li>炒到一半停电</li>\\n</ul>\\n<p>这本账既告诉你“饭做到哪步”，也告诉你“发生了什么事”。<br>\\n不需要再单独维护一本“流程状态账”。</p>","autoDesc":true}')}}]);